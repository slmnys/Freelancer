{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport api from '../utils/axios';\nexport function useMessages(projectId, recipientId) {\n  _s();\n  const queryClient = useQueryClient();\n  const {\n    data: messages,\n    isLoading\n  } = useQuery({\n    queryKey: ['messages', projectId],\n    queryFn: async () => {\n      try {\n        const response = await api.get(`/messages/project/${projectId}`);\n        console.log('Mesaj yanıtı:', response.data);\n        return response.data.data.map(msg => ({\n          id: msg.id,\n          content: msg.content || msg.message_content,\n          createdAt: msg.created_at,\n          isSender: msg.sender_id === parseInt(localStorage.getItem('userId') || '0')\n        }));\n      } catch (error) {\n        console.error('Mesaj getirme hatası:', error);\n        throw error;\n      }\n    },\n    enabled: !!projectId && !!localStorage.getItem('userId')\n  });\n  const sendMessage = useMutation({\n    mutationFn: async content => {\n      if (!recipientId || !projectId) {\n        console.error('Eksik bilgiler:', {\n          recipientId,\n          projectId\n        });\n        throw new Error('Mesaj göndermek için gerekli bilgiler eksik');\n      }\n      const response = await api.post('/messages', {\n        content,\n        projectId,\n        recipientId\n      });\n      if (!response.data.success) {\n        throw new Error(response.data.message || 'Mesaj gönderilemedi');\n      }\n      return response.data.data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: ['messages', projectId]\n      });\n    },\n    onError: error => {\n      console.error('Mesaj gönderme hatası:', error);\n    }\n  });\n  return {\n    messages,\n    isLoading,\n    sendMessage: content => sendMessage.mutate(content)\n  };\n}\n_s(useMessages, \"4tBwuwAnxCQmvLg+SQmm9ValFno=\", false, function () {\n  return [useQueryClient, useQuery, useMutation];\n});","map":{"version":3,"names":["useQuery","useMutation","useQueryClient","api","useMessages","projectId","recipientId","_s","queryClient","data","messages","isLoading","queryKey","queryFn","response","get","console","log","map","msg","id","content","message_content","createdAt","created_at","isSender","sender_id","parseInt","localStorage","getItem","error","enabled","sendMessage","mutationFn","Error","post","success","message","onSuccess","invalidateQueries","onError","mutate"],"sources":["C:/Users/suleymanyasar/Desktop/çalışmalar/cursor2/frontend/src/hooks/useMessages.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport api from '../utils/axios';\r\nimport { ChatMessage } from '../types/chat';\r\n\r\ninterface Message {\r\n    _id: string;\r\n    conversation_id: number;\r\n    sender: {\r\n        _id: string;\r\n        name: string;\r\n        email: string;\r\n    };\r\n    receiver_id: number;\r\n    content: string;\r\n    project_id: number;\r\n    status: 'sent' | 'delivered' | 'read';\r\n    read: boolean;\r\n    createdAt: string;\r\n}\r\n\r\nexport function useMessages(projectId: string, recipientId: string) {\r\n    const queryClient = useQueryClient();\r\n\r\n    const { data: messages, isLoading } = useQuery<ChatMessage[]>({\r\n        queryKey: ['messages', projectId],\r\n        queryFn: async () => {\r\n            try {\r\n                const response = await api.get(`/messages/project/${projectId}`);\r\n                console.log('Mesaj yanıtı:', response.data);\r\n                \r\n                return response.data.data.map((msg: any) => ({\r\n                    id: msg.id,\r\n                    content: msg.content || msg.message_content,\r\n                    createdAt: msg.created_at,\r\n                    isSender: msg.sender_id === parseInt(localStorage.getItem('userId') || '0')\r\n                }));\r\n            } catch (error) {\r\n                console.error('Mesaj getirme hatası:', error);\r\n                throw error;\r\n            }\r\n        },\r\n        enabled: !!projectId && !!localStorage.getItem('userId')\r\n    });\r\n\r\n    const sendMessage = useMutation<Message, Error, string, unknown>({\r\n        mutationFn: async (content: string) => {\r\n            if (!recipientId || !projectId) {\r\n                console.error('Eksik bilgiler:', { recipientId, projectId });\r\n                throw new Error('Mesaj göndermek için gerekli bilgiler eksik');\r\n            }\r\n\r\n            const response = await api.post('/messages', {\r\n                content,\r\n                projectId,\r\n                recipientId\r\n            });\r\n\r\n            if (!response.data.success) {\r\n                throw new Error(response.data.message || 'Mesaj gönderilemedi');\r\n            }\r\n\r\n            return response.data.data;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: ['messages', projectId] });\r\n        },\r\n        onError: (error) => {\r\n            console.error('Mesaj gönderme hatası:', error);\r\n        }\r\n    });\r\n\r\n    return {\r\n        messages,\r\n        isLoading,\r\n        sendMessage: (content: string) => sendMessage.mutate(content)\r\n    };\r\n} "],"mappings":";AAAA,SAASA,QAAQ,EAAEC,WAAW,EAAEC,cAAc,QAAQ,uBAAuB;AAC7E,OAAOC,GAAG,MAAM,gBAAgB;AAmBhC,OAAO,SAASC,WAAWA,CAACC,SAAiB,EAAEC,WAAmB,EAAE;EAAAC,EAAA;EAChE,MAAMC,WAAW,GAAGN,cAAc,CAAC,CAAC;EAEpC,MAAM;IAAEO,IAAI,EAAEC,QAAQ;IAAEC;EAAU,CAAC,GAAGX,QAAQ,CAAgB;IAC1DY,QAAQ,EAAE,CAAC,UAAU,EAAEP,SAAS,CAAC;IACjCQ,OAAO,EAAE,MAAAA,CAAA,KAAY;MACjB,IAAI;QACA,MAAMC,QAAQ,GAAG,MAAMX,GAAG,CAACY,GAAG,CAAC,qBAAqBV,SAAS,EAAE,CAAC;QAChEW,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEH,QAAQ,CAACL,IAAI,CAAC;QAE3C,OAAOK,QAAQ,CAACL,IAAI,CAACA,IAAI,CAACS,GAAG,CAAEC,GAAQ,KAAM;UACzCC,EAAE,EAAED,GAAG,CAACC,EAAE;UACVC,OAAO,EAAEF,GAAG,CAACE,OAAO,IAAIF,GAAG,CAACG,eAAe;UAC3CC,SAAS,EAAEJ,GAAG,CAACK,UAAU;UACzBC,QAAQ,EAAEN,GAAG,CAACO,SAAS,KAAKC,QAAQ,CAACC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,IAAI,GAAG;QAC9E,CAAC,CAAC,CAAC;MACP,CAAC,CAAC,OAAOC,KAAK,EAAE;QACZd,OAAO,CAACc,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;QAC7C,MAAMA,KAAK;MACf;IACJ,CAAC;IACDC,OAAO,EAAE,CAAC,CAAC1B,SAAS,IAAI,CAAC,CAACuB,YAAY,CAACC,OAAO,CAAC,QAAQ;EAC3D,CAAC,CAAC;EAEF,MAAMG,WAAW,GAAG/B,WAAW,CAAkC;IAC7DgC,UAAU,EAAE,MAAOZ,OAAe,IAAK;MACnC,IAAI,CAACf,WAAW,IAAI,CAACD,SAAS,EAAE;QAC5BW,OAAO,CAACc,KAAK,CAAC,iBAAiB,EAAE;UAAExB,WAAW;UAAED;QAAU,CAAC,CAAC;QAC5D,MAAM,IAAI6B,KAAK,CAAC,6CAA6C,CAAC;MAClE;MAEA,MAAMpB,QAAQ,GAAG,MAAMX,GAAG,CAACgC,IAAI,CAAC,WAAW,EAAE;QACzCd,OAAO;QACPhB,SAAS;QACTC;MACJ,CAAC,CAAC;MAEF,IAAI,CAACQ,QAAQ,CAACL,IAAI,CAAC2B,OAAO,EAAE;QACxB,MAAM,IAAIF,KAAK,CAACpB,QAAQ,CAACL,IAAI,CAAC4B,OAAO,IAAI,qBAAqB,CAAC;MACnE;MAEA,OAAOvB,QAAQ,CAACL,IAAI,CAACA,IAAI;IAC7B,CAAC;IACD6B,SAAS,EAAEA,CAAA,KAAM;MACb9B,WAAW,CAAC+B,iBAAiB,CAAC;QAAE3B,QAAQ,EAAE,CAAC,UAAU,EAAEP,SAAS;MAAE,CAAC,CAAC;IACxE,CAAC;IACDmC,OAAO,EAAGV,KAAK,IAAK;MAChBd,OAAO,CAACc,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;IAClD;EACJ,CAAC,CAAC;EAEF,OAAO;IACHpB,QAAQ;IACRC,SAAS;IACTqB,WAAW,EAAGX,OAAe,IAAKW,WAAW,CAACS,MAAM,CAACpB,OAAO;EAChE,CAAC;AACL;AAACd,EAAA,CAxDeH,WAAW;EAAA,QACHF,cAAc,EAEIF,QAAQ,EAqB1BC,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}